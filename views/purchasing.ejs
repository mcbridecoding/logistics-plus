<%- include('partials/header') %>

<%- include('partials/nav-panel') %>

<div id="main" class="main">
    <div class="page-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-receipt-cutoff" viewBox="0 0 16 16">
            <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zM11.5 4a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"/>
            <path d="M2.354.646a.5.5 0 0 0-.801.13l-.5 1A.5.5 0 0 0 1 2v13H.5a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1H15V2a.5.5 0 0 0-.053-.224l-.5-1a.5.5 0 0 0-.8-.13L13 1.293l-.646-.647a.5.5 0 0 0-.708 0L11 1.293l-.646-.647a.5.5 0 0 0-.708 0L9 1.293 8.354.646a.5.5 0 0 0-.708 0L7 1.293 6.354.646a.5.5 0 0 0-.708 0L5 1.293 4.354.646a.5.5 0 0 0-.708 0L3 1.293 2.354.646zm-.217 1.198.51.51a.5.5 0 0 0 .707 0L4 1.707l.646.647a.5.5 0 0 0 .708 0L6 1.707l.646.647a.5.5 0 0 0 .708 0L8 1.707l.646.647a.5.5 0 0 0 .708 0L10 1.707l.646.647a.5.5 0 0 0 .708 0L12 1.707l.646.647a.5.5 0 0 0 .708 0l.509-.51.137.274V15H2V2.118l.137-.274z"/>
        </svg>
        Purchasing
    </div>
    <div class="report-frame">
        <div class="purchasing-card">
            <div class="purchasing-report">
                <div class="purchasing-table">
                    <div class="report-header">
                        <form action="/purchasing/search-PO" method="post" autocomplete="off">
                            <div class="flex-container flex-row flex-between">
                                <div class="search-frame">
                                    <% if (showAll) { %>
                                        <input type="text" name="searchValue" id="searchValue" class="form-control input-md" value="<%= searchValue %>" placeholder="PO#">
                                        <button class="search-button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                            </svg>
                                            Search
                                        </button>
                                        <a class="search-button" href="/purchasing">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                            </svg>
                                            Reset
                                        </a>
                                    <% } else { %>
                                        <input type="text" name="searchValue" id="searchValue" class="form-control input-md" placeholder="PO#">
                                        <button class="search-button">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                            </svg>
                                            Search
                                        </button>
                                    <% } %>
                                </div>
                                <div class="search-frame-right">
                                    <div id="delete-button" class="search-button" onclick="openModal('delete-modal')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
                                            <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
                                        </svg>
                                        Delete
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <table class="table table-secondary table-striped table-hover table-bordered">
                        <thead>
                            <tr class="align-center">
                                <th scope="col" class="tbl-fixed-50">#</th>
                                <th scope="col" class="tbl-fixed-25">
                                    <div class="form-check align-center">
                                        <input class="form-check-input" type="checkbox" id="checkAll">
                                    </div>
                                </th>
                                <th scope="col" class="tbl-sm">Date</th>
                                <th scope="col" class="tbl-sm">PO#</th>
                                <th scope="col" class="tbl-lg">Vendor</th>
                                <th scope="col" class="tbl-md">Invoice Total</th>
                                <th scope="col" class="tbl-sm">Status</th>
                                <th scope="col" colspan="3" class="">Options</th>
                            </tr>
                        </thead>
                        <tbody>
                            <form id="delete-form" action="/purchasing/delete-po" method="post">
                            <% purchaseOrders.forEach((purchaseOrder, index) => { %>
                            <tr class="align-center">
                                <td><%= index + 1 %></td>
                                <td class="">
                                    <div class="form-check">
                                        <input class="form-check-input checkbox-option" type="checkbox" name="poId" value="<%= purchaseOrder._id %>" id="">
                                    </div>
                                </td>
                                <td><%= purchaseOrder.date %></td>
                                <td><%= purchaseOrder.purchaseOrderNumber %></td>
                                <td class="align-left"><%= purchaseOrder.vendor.company %></td>
                                <% if (purchaseOrder.invoiceTotal === '') { %>
                                    <td class="align-center">-</td>
                                <% } else { %>
                                    <td class="align-right"><%= purchaseOrder.invoiceTotal %></td>
                                <% } %>
                                <td class="align-center proper-case"><%= purchaseOrder.orderStatus.status %></td>
                                <td class="table-options align-middle">                        
                                    <a class="" href="/purchasing/view-po-id=<%= purchaseOrder._id %>">              
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                                        </svg>
                                    </a>
                                </td>
                                <td class="table-options">
                                    <a href="/print-purchase-order-<%= purchaseOrder._id %>">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-printer" viewBox="0 0 16 16">
                                            <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                                            <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
                                        </svg>
                                    </a>
                                </td>
                                <td class="table-options">
                                    <div class="" onclick="openModal('<%= purchaseOrder._id %>')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                                        </svg>
                                    </div>
                                </td>
                            </tr>
                            <% }) %>
                            </form>
                        </tbody>
                    </table>
                    <% if (pages >= 2) { %>
                        <div class="pagination-panel">
                            <nav aria-label="Page navigation example">
                                <ul class="pagination">
                                    <% if (pageNumber != 1) { %>
                                        <li class="page-item"><a class="page-link" href="?page=<%= Number(pageNumber) - 1%>">Previous</a></li>
                                    <% } %>
                                    <% for (var a = 1; a <= pages; a++) { %>
                                        <li class="page-item"><a class="page-link" href="?page=<%= a; %>"><%= a; %></a></li>
                                    <% } %>
                                    <% if (pageNumber != pages) { %>
                                        <li class="page-item"><a class="page-link" href="?page=<%= Number(pageNumber) + 1%>">Next</a></li>
                                    <% } %>
                                </ul>
                            </nav>
                        </div>
                    <% } %>
                </div>
            </div>
            <div class="purchasing-menu">
                <h2>Purchasing Menu:</h2>
                <a href="/purchasing/new-order" class="purchasing-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-plus" viewBox="0 0 16 16">
                        <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
                        <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                    </svg>
                    New Purchase Order
                </a>
                <h2>Reports:</h2>
                <a class="purchasing-button" href="/purchasing/orders=open">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dot" viewBox="0 0 16 16">
                        <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                    </svg>
                    Open Orders
                </a>
                <a class="purchasing-button" href="/purchasing/orders=closed">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dot" viewBox="0 0 16 16">
                        <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                    </svg>
                    Closed Orders
                </a>
                <a class="purchasing-button" href="/purchasing/orders=All">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dot" viewBox="0 0 16 16">
                        <path d="M8 9.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/>
                    </svg>
                    All Orders
                </a>
                <div class="purchasing-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-columns-reverse" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 0 .5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10A.5.5 0 0 1 4 .5Zm-4 2A.5.5 0 0 1 .5 2h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 4h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 6h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 8h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Z"/>
                    </svg>
                    Reports
                </div>
            </div>   
        </div>
    </div>
</div>
<% purchaseOrders.forEach((purchaseOrder) => { %>
    <div id="<%= purchaseOrder._id %>" class="modal-frame">
        <form action="/purchasing/update-status" method="POST" autocomplete="off">
            <div class="modal-header">
                <h3>Update Purchase Order</h3>
                <div class="close-button" onclick="closeModal('<%= purchaseOrder._id %>')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </div>
            </div>
            <div class="modal-body">
                <div class="flex-container flex-row gap-25">
                    <div class="input-sm">
                        <label for="status" class="form-label">Status:</label>
                        <select class="form-select" name="status" id="" required>
                            <% if (purchaseOrder.orderStatus.status === 'open') { %>
                                <option value="closed">Closed</option>
                                <option value="open" selected>Open</option>
                            <% } else { %>
                                <option value="closed" selected>Closed</option>
                                <option value="open">Open</option>
                            <% } %>
                        </select>
                    </div>
                    <div class="input-sm">                    
                        <label for="paymentDate" class="form-label">Payment Date:</label>
                        <input class="form-control" type="date" id="" name="paymentDate" value="<%= purchaseOrder.orderStatus.paymentDate %>">
                    </div> 
                    <div class="input-sm">                    
                        <label for="paymentType" class="form-label">Payment Type:</label>
                        <input class="form-control" type="text" id="" name="paymentType" value="<%= purchaseOrder.orderStatus.paymentType %>" autocomplete="on">
                    </div>
                    <div class="input-sm">
                        <label for="productReceived" class="form-label">Product Recieved:</label>
                        <select class="form-select" name="productReceived" id="" required>
                            <% if (purchaseOrder.orderStatus.productReceived) { %>
                                <option value="true" selected>True</option>
                                <option value="false">False</option>
                            <% } else { %>
                                <option value="true">True</option>
                                <option value="false" selected>False</option>
                            <% } %>
                        </select>
                    </div>
                </div>
                <div class="modal-button-group">
                    <button type="submit" name="poId" class="modal-button" value="<%= purchaseOrder._id %>">Update</button>
                    <div onclick="closeModal('<%= purchaseOrder._id %>')" class="modal-button">Cancel</div>
                </div>
            </form>
        </div>
    </div>
<% }) %>
<div id="delete-modal" class="modal-frame">
    <div class="modal-header">
        <h3>Delete Selected?</h3>
        <div class="close-button" onclick="closeModal('delete-modal')">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
            </svg>
        </div>
    </div>
    <div class="modal-body">
        <div class="modal-body-text">
            <h3>Are you sure you would like to delete the Selected Purchase Order(s)?</h2>
        </div>
        <div class="modal-button-group">
            <button type="submit" form="delete-form" class="modal-button">Yes</a>
            <button class="modal-button" onclick="closeModal('delete-modal')">Cancel</button>
        </div>
    </div>
</div>
<%- include('partials/footer') %>