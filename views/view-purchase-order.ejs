<%- include('partials/header') %>

<%- include('partials/nav-panel') %>

<div id="main" class="main">
    <form action="/purchasing/edit-po/id=<%= purchaseOrder._id %>" method="POST" autocomplete="off">
        <div class="page-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bag-plus" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 7.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V12a.5.5 0 0 1-1 0v-1.5H6a.5.5 0 0 1 0-1h1.5V8a.5.5 0 0 1 .5-.5z"/>
                <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5zM2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V5z"/>
            </svg>
            View Purchase Order
        </div>
        <div class="purchase-order-body">
            <div class="new-quote-form">
                <div class="flex-container flex-row flex-start gap-50 purchase-order-row">
                    <div class="">                    
                        <label for="poNumber" class="form-label">PO#:</label>
                        <input class="form-control input-md" type="text" id="poNumber" name="poNumber" value="<%= purchaseOrder.purchaseOrderNumber %>" readonly required>
                    </div>
                    <div class="">                    
                        <label for="date" class="form-label">Date:</label>
                        <input class="form-control input-sm" type="date" id="date" name="date" value="<%= purchaseOrder.date %>" required>
                    </div>            
                    <div class="">                    
                        <label for="shipVia" class="form-label">Ship Via:</label>
                        <input class="form-control input-md" type="text" id="shipVia" name="shipVia" value="<%= purchaseOrder.shipMethod %>" required>
                    </div> 
                    <div class="">                    
                        <label for="currency" class="form-label">Currency:</label>
                        <select class="form-select input-md" name="currency" id="currency">
                            <% if (purchaseOrder.currency === 'CAD') { %>
                                <option value="CAD" selected>CAD</option>
                                <option value="USD">USD</option>
                            <% } else { %>
                                <option value="CAD">CAD</option>
                                <option value="USD" selected>USD</option>
                            <% } %>
                        </select>
                    </div> 
                </div>
                <div class="flex-container flex-row flex-between">
                    <div>
                        <label for="soldTo" class="form-label">Bill To:</label>
                        <select class="form-select input-xlg" name="soldTo" id="soldTo">
                            <% addressList.forEach((address) => { %>
                                <% if (address._id == purchaseOrder.soldTo.id) { %>
                                    <option value="<%= address._id %>" selected><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } else { %>
                                    <option value="<%= address._id %>"><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } %>
                            <% }) %>
                        </select>
                    </div>
                    <div>
                        <label for="vendor" class="form-label">Vendor:</label>
                        <select class="form-select input-xlg" name="vendor" id="vendor">
                            <% addressList.forEach((address) => { %>
                                <% if (address._id == purchaseOrder.vendor.id) { %>
                                    <option value="<%= address._id %>" selected><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } else { %>
                                    <option value="<%= address._id %>"><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } %>
                            <% }) %>
                        </select>
                    </div>
                    <div>
                        <label for="shipTo" class="form-label">Ship To:</label>
                        <select class="form-select input-xlg" name="shipTo" id="shipTo">
                            <% addressList.forEach((address) => { %>
                                <% if (address._id == purchaseOrder.shipTo.id) { %>
                                    <option value="<%= address._id %>" selected><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } else { %>
                                    <option value="<%= address._id %>"><%= address.company %> - <%= address.addressOne %>. <%= address.city %>. <%= address.state %></option>
                                <% } %>
                            <% }) %>
                        </select>
                    </div>
                </div> 
                <div class="purchase-order-row">
                    <label for="notes" class="form-label">Notes:</label>
                    <textarea class="form-control" name="notes" id="notes" rows="4"><%= purchaseOrder.notes %></textarea>
                </div>
                <div class="purchase-order-row">
                    <div class="flex-container flex-row flex-end">
                        <div class="options-button" onclick="openModal('add-line-item-modal')">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-square" viewBox="0 0 16 16">
                                <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            Add Item
                        </div>
                    </div>
                    <table class="table table-secondary table-striped table-hover table-bordered">
                        <thead>
                            <tr class="align-center">
                                <th scope="col" class="table-options">#</th>
                                <th scope="col">Item Id</th>
                                <th scope="col">Description</th>
                                <th scope="col" class="table-column-small">Qty</th>
                                <th scope="col" class="table-column-small">Price</th>
                                <th scope="col" class="table-column-small">Line Total</th>
                                <th scope="col" class="table-options"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <% purchaseOrder.lineItems.forEach((lineItem, index) => { %>
                            <tr>
                                <td><%= index + 1 %></td>
                                <td><%= lineItem.itemId %></td>
                                <td><%= lineItem.itemDescription %></td>
                                <td class="align-center"><%= lineItem.quantity %></td>
                                <td class="align-right">$ <%= lineItem.unitValue %></td>
                                <td class="align-right">$ <%= lineItem.lineTotal %></td>
                                <td></td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                </div>
                <div class="purchasing-button-group">
                    <div class="flex-container flex-row flex-end">
                        <button class="options-button">Save & Print</button>   
                        <a href="/purchasing" class="options-button">Cancel</a>   
                    </div>
                </div>       
            </div>
        </div>
    </form>
</div>
<div id="add-line-item-modal" class="modal-frame">
    <div class="modal-header">
        <h3>Add Line Item</h3>
        <div class="close-button" onclick="closeModal('add-line-item-modal')">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
            </svg>
        </div>
    </div>
    <form action="/purchasing/type=product/po=<%= purchaseOrder._id %>/add-line-item" method="POST">
        <div class="modal-body">
            <div class="flex-container flex-row flex-between gap-25">
                <div>
                    <label for="lineItem" class="form-label">Lookup:</label>
                    <select class="form-select input-xlg" name="lineItem" id="lineItem" onchange="addSku(this.value)">
                        <option value="new">-- Create New --</option>
                        <% items.forEach((item) => { %>
                        <option value="<%= item._id %>"><%= item.itemId %> -- <%= item.itemDescription %></option>
                        <% }) %>
                    </select>
                </div>
                <div>
                    <label for="quantity" class="form-label">Qty:</label>
                    <input class="form-control input-xs" type="text" id="quantity" name="quantity">  
                </div>
                <div>
                    <label for="unitValue" class="form-label">Price:</label>
                    <input class="form-control input-xs" type="text" id="unitValue" name="unitValue">  
                </div>
            </div>
            <div id="sku" class="flex-container flex-row flex-start gap-25">
                <div>
                    <label for="itemId" class="form-label">Item Id:</label>
                    <input class="form-control input-lg" type="text" id="itemId" name="itemId">  
                </div>
                <div>
                    <label for="itemDescription" class="form-label">Item Description:</label>
                    <input class="form-control input-xlg" type="text" id="itemDescription" name="itemDescription">  
                </div>
            </div>
            <div id="reorder" class="flex-container flex-row flex-start gap-25">
                <div>
                    <label for="reOrderPoint" class="form-label">Re Order Point:</label>
                    <input type="text" class="form-control input-sm" name="reOrderPoint" value="<%=  %>">
                </div>
                <div>
                    <label for="sellPrice" class="form-label">Sell Price:</label>
                    <input type="text" class="form-control input-sm" name="sellPrice" value="<%=  %>">
                </div>
                <div>
                    <label for="uom" class="form-label">UOM:</label>
                    <select class="form-select input-xs" name="uom" id="">
                        <option value="ea">ea</option>
                        <option value="cubic inch">Cubic Inch</option>
                    </select>  
                </div>
            </div>
            <div class="modal-button-group">
                <button type="submit" class="modal-button">Submit</button>
                <div onclick="closeModal('add-line-item-modal')" class="modal-button">Cancel</div>
            </div>
        </div>
    </form>
</div>

<%- include('partials/footer') %>